{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://grantcraft.dev/schema/pack.schema.json",
  "title": "GrantCraft Scheme Pack",
  "description": "JSON Schema for validating GrantCraft scheme pack files (pack.json). A scheme pack describes the structure, evaluation criteria, required sections, compliance checklist, and scoring rules for a specific grant funding scheme.",
  "type": "object",
  "required": [
    "id",
    "name",
    "version",
    "spec_version",
    "description",
    "metadata",
    "page_limits",
    "scoring_rules",
    "evaluation_criteria",
    "required_sections",
    "compliance_checklist"
  ],
  "additionalProperties": true,
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_]*$",
      "description": "Unique snake_case identifier for the scheme pack. Must start with a lowercase letter.",
      "examples": ["horizon_europe_ria_ia", "ukri_innovate_uk", "nsf_career"]
    },
    "name": {
      "type": "string",
      "minLength": 5,
      "maxLength": 200,
      "description": "Full human-readable name of the funding scheme."
    },
    "short_name": {
      "type": "string",
      "maxLength": 50,
      "description": "Short display name used in UI labels."
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the pack (MAJOR.MINOR.PATCH)."
    },
    "spec_version": {
      "type": "string",
      "description": "Version of the GrantCraft pack specification this pack conforms to.",
      "enum": ["1"]
    },
    "description": {
      "type": "string",
      "minLength": 20,
      "description": "Human-readable description of the scheme, suitable for display in the UI."
    },
    "metadata": {
      "type": "object",
      "required": ["funding_body", "last_updated", "contributor"],
      "properties": {
        "funding_body": {
          "type": "string",
          "description": "Name of the organisation that administers this funding scheme."
        },
        "programme": {
          "type": "string",
          "description": "Name of the broader programme (e.g., Horizon Europe, UKRI)."
        },
        "action_types": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of action types covered (e.g., [\"RIA\", \"IA\"])."
        },
        "funding_rate": {
          "type": "object",
          "description": "Funding rate per entity or action type.",
          "additionalProperties": { "type": "string" }
        },
        "source_documents": {
          "type": "array",
          "items": { "type": "string" },
          "description": "List of authoritative documents from which this pack was derived."
        },
        "last_updated": {
          "type": "string",
          "pattern": "^\\d{4}-\\d{2}-\\d{2}$",
          "description": "Date this pack was last reviewed for accuracy (ISO 8601 format)."
        },
        "contributor": {
          "type": "string",
          "description": "Name or handle of the primary contributor of this pack."
        },
        "notes": {
          "type": "string",
          "description": "Any caveats or important notes about this pack's scope and limitations."
        }
      },
      "additionalProperties": true
    },
    "page_limits": {
      "type": "object",
      "required": ["default_total"],
      "properties": {
        "default_total": {
          "type": "number",
          "minimum": 1,
          "description": "Default total page limit for a proposal under this scheme."
        },
        "unit": { "type": "string" },
        "font_requirements": { "type": "string" },
        "line_spacing": { "type": "string" },
        "margins_minimum_mm": { "type": "number" },
        "call_specific_note": {
          "type": "string",
          "description": "Warning about call-level deviations from the default."
        },
        "per_section_guidance": {
          "type": "object",
          "additionalProperties": { "type": "string" }
        },
        "pages_NOT_counted": {
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "additionalProperties": true
    },
    "scoring_rules": {
      "type": "object",
      "required": ["threshold_per_criterion", "overall_threshold", "max_score_per_criterion", "total_max_score"],
      "properties": {
        "threshold_per_criterion": {
          "type": "number",
          "minimum": 0,
          "description": "Minimum score required on each individual criterion to pass."
        },
        "overall_threshold": {
          "type": "number",
          "minimum": 0,
          "description": "Minimum total score (sum of all criteria) required to pass."
        },
        "max_score_per_criterion": {
          "type": "number",
          "minimum": 1,
          "description": "Maximum score achievable per criterion."
        },
        "total_max_score": {
          "type": "number",
          "minimum": 1,
          "description": "Maximum possible total score (sum of all criteria maxima)."
        },
        "scoring_step": {
          "type": "number",
          "description": "Minimum increment between scores (e.g., 0.5 for half-point scoring)."
        },
        "weights": {
          "type": "object",
          "additionalProperties": { "type": "number" },
          "description": "Weight of each criterion (should sum to 1.0)."
        },
        "rejection_rule": { "type": "string" },
        "ranking_note": { "type": "string" }
      },
      "additionalProperties": true
    },
    "evaluation_criteria": {
      "type": "array",
      "minItems": 1,
      "description": "The evaluation criteria used to score the proposal.",
      "items": {
        "type": "object",
        "required": ["id", "title", "weight", "threshold", "max_score", "description"],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-z][a-z0-9_]*$",
            "description": "Unique snake_case identifier for the criterion."
          },
          "title": { "type": "string" },
          "weight": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Relative weight of this criterion (0â€“1; all weights should sum to ~1.0)."
          },
          "threshold": {
            "type": "number",
            "description": "Minimum passing score for this criterion."
          },
          "max_score": {
            "type": "number",
            "description": "Maximum achievable score for this criterion."
          },
          "description": { "type": "string" },
          "sub_criteria": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "title", "description"],
              "properties": {
                "id": { "type": "string" },
                "title": { "type": "string" },
                "description": { "type": "string" }
              }
            }
          },
          "what_reviewers_look_for": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Checklist of specific elements reviewers assess for this criterion."
          },
          "common_pitfalls": {
            "type": "array",
            "items": { "type": "string" },
            "description": "Frequently observed weaknesses that lower scores on this criterion."
          },
          "differentiated_by_action_type": {
            "type": "object",
            "additionalProperties": { "type": "string" },
            "description": "How reviewer expectations differ by action type (e.g., RIA vs. IA)."
          }
        },
        "additionalProperties": true
      }
    },
    "required_sections": {
      "type": "array",
      "minItems": 1,
      "description": "Ordered list of required proposal sections, each with sub-sections.",
      "items": {
        "type": "object",
        "required": ["id", "title", "order", "required"],
        "properties": {
          "id": { "type": "string", "pattern": "^[a-z][a-z0-9_]*$" },
          "title": { "type": "string" },
          "order": { "type": "integer", "minimum": 1 },
          "required": { "type": "boolean" },
          "page_budget_guidance": { "type": "string" },
          "description": { "type": "string" },
          "subsections": {
            "type": "array",
            "items": {
              "type": "object",
              "required": ["id", "title", "order", "required", "criterion"],
              "properties": {
                "id": { "type": "string" },
                "title": { "type": "string" },
                "order": { "type": "integer", "minimum": 1 },
                "required": { "type": "boolean" },
                "criterion": {
                  "type": "string",
                  "description": "ID of the evaluation criterion this subsection is assessed under."
                },
                "word_count_guidance": {
                  "type": "object",
                  "properties": {
                    "min": { "type": "integer" },
                    "recommended": { "type": "integer" },
                    "max": { "type": "integer" }
                  }
                },
                "key_questions": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "must_include": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "keywords_to_cover": {
                  "type": "array",
                  "items": { "type": "string" }
                }
              },
              "additionalProperties": true
            }
          }
        },
        "additionalProperties": true
      }
    },
    "compliance_checklist": {
      "type": "array",
      "minItems": 1,
      "description": "List of compliance and quality-assurance items that a proposal must or should address.",
      "items": {
        "type": "object",
        "required": ["id", "label", "category", "required"],
        "properties": {
          "id": { "type": "string" },
          "label": { "type": "string" },
          "category": {
            "type": "string",
            "enum": ["ethics", "open_science", "dissemination", "management", "legal", "equality", "compliance"]
          },
          "required": { "type": "boolean" },
          "recommended": { "type": "boolean" },
          "part": { "type": "string" },
          "section_reference": { "type": "string" },
          "check_description": { "type": "string" },
          "failure_consequence": { "type": "string" },
          "tips": {
            "type": "array",
            "items": { "type": "string" }
          }
        },
        "additionalProperties": true
      }
    },
    "glossary": {
      "type": "object",
      "additionalProperties": { "type": "string" },
      "description": "Key terms and abbreviations relevant to this funding scheme."
    },
    "keywords_index": {
      "type": "object",
      "additionalProperties": {
        "type": "array",
        "items": { "type": "string" }
      },
      "description": "Per-criterion keyword lists used by the GrantCraft scoring engine."
    }
  }
}
